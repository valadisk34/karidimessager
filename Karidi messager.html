<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Stragali Messager</title>
<style>
body {
  font-family: Arial, sans-serif;
  background-color: #f5f5f5;
  margin: 0;
  padding: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.container {
  width: 400px;
  background-color: white;
  border-radius: 8px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

.login-container {
  padding: 20px;
}

.login-container h2 {
  margin-top: 0;
  color: #333;
}

.input-group {
  margin-bottom: 15px;
}

input {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 80px;
  box-sizing: border-box;
}

button {
  background-color: #000000;
  color: white;
  border: none;
  padding: 10px 15px;
  border-radius: 80px;
  cursor: pointer;
  width: 100%;
}

button:hover {
  background-color: green;
}

.chat-container {
  display: none;
  height: 500px;
  flex-direction: column;
}

.chat-header {
  background-color: #000000;
  color: white;
  padding: 15px;
  text-align: center;
  font-weight: bold;
}

.chat-messages {
  flex: 1;
  padding: 15px;
  overflow-y: auto;
  background-color: #f9f9f9;
}

.message {
  margin-bottom: 10px;
  padding: 8px 12px;
  background-color: rgb(0, 128, 255);
  border-radius: 100px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.message b {
  color: #ffffff;
}

.message small {
  color: #ffffff;
  font-size: 0.8em;
  margin-left: 5px;
}

.chat-input {
  padding: 15px;
  border-top: 1px solid #ddd;
  background-color: white;
}

.input-row {
  display: flex;
  margin-bottom: 10px;
}

.input-row input {
  flex: 1;
  margin-right: 10px;
}

#message {
  width: 85%;
}

.send-btn {
  width: 15% !important;
  padding: 10px 5px !important;
}

.delete-btn {
  background-color: #e74c3c;
  margin-top: 10px;
  width: 100%;
}

.delete-btn:hover {
  background-color: #c0392b;
}

.notification {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  background-color: #e74c3c;
  color: white;
  padding: 10px 20px;
  border-radius: 4px;
  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  display: none;
  z-index: 1000;
}

/* Popup overlay */
#deletePopup {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(0,0,0,0.6);
  justify-content: center;
  align-items: center;
  z-index: 2000;
}

#deletePopup .popup-content {
  background: white;
  padding: 20px;
  border-radius: 8px;
  width: 400px;
  text-align: center;
}
</style>
</head>
<body>

<div class="container">
  <div id="login" class="login-container">
    <div class="header">Stragali Messager</div>
    <h2>Login</h2>
    <div class="input-group">
      <input id="password" type="password" placeholder="Password">
    </div>
    <button onclick="login()">Enter</button>
  </div>

  <div id="chat" class="chat-container">
    <div class="chat-header">Stragali Messager</div>
    <div class="input-group" style="padding: 15px;">
      <input id="username" placeholder="Name">
    </div>
    <div id="messages" class="chat-messages"></div>
    <div class="chat-input">
      <div class="input-row">
        <input id="message" placeholder="Type your message">
        <button class="send-btn" onclick="sendMessage()">Sent</button>
      </div>
      <button class="delete-btn">ΚΟΥΜΠΙ ΕΚΤΑΚΤΗΣ ΑΝΑΓΚΗΣ</button>
    </div>
  </div>
</div>

<div id="notification" class="notification"></div>

<!-- Emergency Delete Popup -->
<div id="deletePopup">
  <div class="popup-content">
    <h3 style="color: red;">ΠΡΟΣΟΧΗ!</h3>
    <p style="text-align: left; font-size: 14px;">
      ΠΡΑΓΜΑΤΟΠΟΙΟΝΤΑΣ ΑΥΤΗΝ ΤΗΝ ΕΝΕΡΓΕΙΑ ΕΝΔΕΧΕΤΑΙ ΝΑ ΣΥΜΒΟΥΝ ΤΑ ΠΑΡΑΚΑΤΩ:<br><br>
      - ΑΥΤΟΜΑΤΗ ΑΛΛΑΓΗ ΤΟΥ ΚΩΔΙΚΟΥ ΠΡΟΣΒΑΣΗΣ<br>
      - ΔΙΑΓΡΑΦΗ ΟΛΩΝ ΤΩΝ ΣΥΝΟΜΙΛΙΩΝ<br>
      - ΚΛΕΙΔΩΜΑ ΤΗΣ ΣΥΝΟΜΙΛΙΑΣ ΕΩΣ ΤΟ ΧΕΙΡΟΚΙΝΗΤΟ ΞΕΚΛΕΙΔΩΜΑ ΑΠΟ ΤΟΝ SERVER
    </p>
    <p style="margin-top: 10px; font-weight: bold;">
      ΓΙΑ ΝΑ ΠΡΟΧΩΡΙΣΕΤΕ ΕΙΣΑΓΕΤΕ ΤΟΝ ΚΩΔΙΚΟ:
    </p>
    <input type="password" id="deletePassword" style="
      width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px;
    "><br><br>
    <button onclick="confirmDelete()" style="background:red;color:white;padding:8px 12px;border:none;border-radius:4px;">ΣΥΝΕΧΕΙΑ</button>
    <button onclick="closeDeletePopup()" style="background:gray;color:white;padding:8px 12px;border:none;border-radius:4px;margin-left:5px;">ΑΚΥΡΟ</button>
  </div>
</div>

<script>
const serverURL = "https://script.google.com/macros/s/AKfycbyHEOaVdu60Tq48qzkyvrMveAm8zE4DI5IZRBfjCL9dS0HEHFTiRMJdiljsnkVYTbH_FA/exec";
let chatPassword = "";

function showNotification(message) {
  const notification = document.getElementById("notification");
  notification.textContent = message;
  notification.style.display = "block";
  setTimeout(() => {
    notification.style.display = "none";
  }, 3000);
}

function login() {
  chatPassword = document.getElementById("password").value;
  fetch(serverURL, {
    method: "POST",
    body: JSON.stringify({
      action: "login",
      password: chatPassword
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "success") {
      document.getElementById("login").style.display = "none";
      document.getElementById("chat").style.display = "flex";
      loadMessages();
    } else {
      showNotification("Λάθος κωδικός!");
    }
  });
}

function loadMessages() {
  fetch(serverURL)
    .then(res => res.json())
    .then(data => {
      const container = document.getElementById("messages");
      container.innerHTML = "";
      data.forEach(row => {
        let time = new Date(row[0]).toLocaleTimeString();
        container.innerHTML += `<div class="message"><b>${row[1]}</b>: ${row[2]} <small>${time}</small></div>`;
      });
      container.scrollTop = container.scrollHeight;
    });
}

function sendMessage() {
  const username = document.getElementById("username").value;
  const message = document.getElementById("message").value;
  
  if (!username) {
    showNotification("Παρακαλώ εισάγετε όνομα");
    return;
  }
  
  if (!message) {
    showNotification("Παρακαλώ εισάγετε μήνυμα");
    return;
  }
  
  fetch(serverURL, {
    method: "POST",
    body: JSON.stringify({
      password: chatPassword,
      username: username,
      message: message
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "success") {
      document.getElementById("message").value = "";
      loadMessages();
    } else {
      showNotification("Λάθος κωδικός!");
    }
  });
}

setInterval(loadMessages, 2000);

// Emergency Delete Popup
document.querySelector(".delete-btn").addEventListener("click", () => {
  document.getElementById("deletePopup").style.display = "flex";
});

function closeDeletePopup() {
  document.getElementById("deletePopup").style.display = "none";
}

function confirmDelete() {
  const pass = document.getElementById("deletePassword").value;

  fetch(serverURL, {
    method: "POST",
    body: JSON.stringify({
      action: "emergencyDelete",
      password: pass
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.status === "success") {
      alert("Η συνομιλία διαγράφηκε, ο κωδικός άλλαξε και η συνομιλία κλειδώθηκε.");
      location.reload();
    } else {
      showNotification("Λάθος κωδικός!");
    }
    closeDeletePopup();
  });
}
</script>

</body>
</html>
